{"version":3,"sources":["/Users/matt/Sites/MarketEdge/platform-wrapper/frontend/src/hooks/useModuleFeatureFlags.ts"],"sourcesContent":["'use client'\n\nimport { useQuery, useQueryClient } from 'react-query'\nimport { useAuth } from './useAuth'\nimport { moduleFeatureFlagApiService } from '@/services/module-feature-flag-api'\nimport {\n  UseModuleFeatureFlagsResult,\n  UseModuleDiscoveryResult,\n  UseModuleFlagHierarchyResult,\n  ModuleFeatureFlagOptions,\n  ModuleFeatureFlagError,\n  ModuleDiscoveryResponse\n} from '@/types/module-feature-flags'\n\n// Query key factory for module feature flags\nexport const moduleFeatureFlagKeys = {\n  all: ['moduleFeatureFlags'] as const,\n  modules: () => ['moduleFeatureFlags', 'modules'] as const,\n  module: (moduleId: string) => ['moduleFeatureFlags', 'module', moduleId] as const,\n  discovery: (userId?: string) => ['moduleFeatureFlags', 'discovery', userId] as const,\n  hierarchy: (moduleId: string) => ['moduleFeatureFlags', 'hierarchy', moduleId] as const,\n  capabilities: (moduleId: string) => ['moduleFeatureFlags', 'capabilities', moduleId] as const,\n  health: (moduleId: string) => ['moduleFeatureFlags', 'health', moduleId] as const,\n  accessible: () => ['moduleFeatureFlags', 'accessible'] as const,\n}\n\n// Default options\nconst DEFAULT_OPTIONS: Required<ModuleFeatureFlagOptions> = {\n  includeDisabled: false,\n  moduleTypes: [],\n  categories: [],\n  requiredFlagsOnly: false,\n  includeInherited: true,\n  hierarchyDepth: 4,\n  cacheTime: 5 * 60 * 1000, // 5 minutes\n  staleTime: 2 * 60 * 1000, // 2 minutes\n  refetchInterval: false,\n  preloadCapabilities: true,\n  batchSize: 10,\n}\n\n/**\n * Hook for getting all module feature flags and their states\n */\nexport function useModuleFeatureFlags(\n  options: ModuleFeatureFlagOptions = {}\n): UseModuleFeatureFlagsResult {\n  const { user, isAuthenticated } = useAuth()\n  const queryClient = useQueryClient()\n  \n  const mergedOptions = { ...DEFAULT_OPTIONS, ...options }\n  \n  const query = useQuery({\n    queryKey: moduleFeatureFlagKeys.modules(),\n    queryFn: () => moduleFeatureFlagApiService.getModulesWithFlags(),\n    enabled: isAuthenticated,\n    cacheTime: mergedOptions.cacheTime,\n    staleTime: mergedOptions.staleTime,\n    refetchInterval: mergedOptions.refetchInterval,\n    onError: (error) => {\n      console.warn('Module feature flags check failed:', error)\n    },\n  })\n\n  const refetch = () => {\n    queryClient.invalidateQueries(moduleFeatureFlagKeys.modules())\n    return query.refetch()\n  }\n\n  // Process module flags data\n  const moduleFlags: Record<string, boolean> = {}\n  const moduleConfigs: Record<string, Record<string, any>> = {}\n  const enabledModules: string[] = []\n  const disabledModules: string[] = []\n  const moduleCapabilities: Record<string, string[]> = {}\n\n  if (query.data) {\n    query.data.forEach(moduleData => {\n      const moduleId = moduleData.module.id\n      const hasRequiredFlags = moduleData.module.required_flags.every(\n        flagKey => moduleData.enabled_flags[flagKey]?.enabled\n      )\n\n      // Module is enabled if all required flags are enabled\n      const moduleEnabled = hasRequiredFlags && \n        moduleData.health_status !== 'unavailable'\n\n      moduleFlags[moduleId] = moduleEnabled\n      \n      if (moduleEnabled) {\n        enabledModules.push(moduleId)\n      } else {\n        disabledModules.push(moduleId)\n      }\n\n      // Collect module configurations\n      moduleConfigs[moduleId] = {}\n      Object.entries(moduleData.enabled_flags).forEach(([flagKey, flagData]) => {\n        moduleConfigs[moduleId][flagKey] = flagData.config || {}\n      })\n\n      // Collect capabilities\n      moduleCapabilities[moduleId] = moduleData.available_capabilities\n    })\n  }\n\n  return {\n    moduleFlags,\n    moduleConfigs,\n    isLoading: query.isLoading,\n    error: query.error instanceof Error ? query.error : null,\n    enabledModules,\n    disabledModules,\n    moduleCapabilities,\n    refetch,\n    lastUpdated: query.dataUpdatedAt ? new Date(query.dataUpdatedAt) : undefined,\n  }\n}\n\n/**\n * Hook for module discovery - getting available modules based on feature flags\n */\nexport function useModuleDiscovery(\n  userId?: string,\n  options: Omit<ModuleFeatureFlagOptions, 'hierarchyDepth'> = {}\n): UseModuleDiscoveryResult {\n  const { user, isAuthenticated } = useAuth()\n  const queryClient = useQueryClient()\n  \n  const mergedOptions = { ...DEFAULT_OPTIONS, ...options }\n  const effectiveUserId = userId || user?.id\n  \n  const query = useQuery({\n    queryKey: moduleFeatureFlagKeys.discovery(effectiveUserId),\n    queryFn: () => moduleFeatureFlagApiService.discoverEnabledModules(\n      effectiveUserId,\n      user?.organisation_id\n    ),\n    enabled: isAuthenticated,\n    cacheTime: mergedOptions.cacheTime,\n    staleTime: mergedOptions.staleTime,\n    refetchInterval: mergedOptions.refetchInterval,\n    onError: (error) => {\n      console.warn('Module discovery failed:', error)\n    },\n  })\n\n  const refresh = () => {\n    queryClient.invalidateQueries(moduleFeatureFlagKeys.discovery(effectiveUserId))\n    return query.refetch()\n  }\n\n  return {\n    enabledModules: query.data?.enabled_modules || [],\n    disabledModules: query.data?.disabled_modules || [],\n    isLoading: query.isLoading,\n    error: query.error instanceof Error ? query.error : null,\n    totalAvailable: query.data?.total_available || 0,\n    userAccessible: query.data?.user_accessible || 0,\n    refresh,\n    lastUpdated: query.dataUpdatedAt ? new Date(query.dataUpdatedAt) : undefined,\n  }\n}\n\n/**\n * Hook for getting module flag hierarchy and inheritance\n */\nexport function useModuleFlagHierarchy(\n  moduleId: string,\n  options: Pick<ModuleFeatureFlagOptions, 'hierarchyDepth' | 'includeInherited' | 'cacheTime' | 'staleTime'> = {}\n): UseModuleFlagHierarchyResult {\n  const { isAuthenticated } = useAuth()\n  const queryClient = useQueryClient()\n  \n  const mergedOptions = { ...DEFAULT_OPTIONS, ...options }\n  \n  const query = useQuery({\n    queryKey: moduleFeatureFlagKeys.hierarchy(moduleId),\n    queryFn: () => moduleFeatureFlagApiService.getModuleFlagHierarchy(moduleId),\n    enabled: isAuthenticated && !!moduleId,\n    cacheTime: mergedOptions.cacheTime,\n    staleTime: mergedOptions.staleTime,\n    onError: (error) => {\n      console.warn(`Module flag hierarchy check failed for '${moduleId}':`, error)\n    },\n  })\n\n  const refetch = () => {\n    queryClient.invalidateQueries(moduleFeatureFlagKeys.hierarchy(moduleId))\n    return query.refetch()\n  }\n\n  // Extract effective flags and configs\n  const effectiveFlags: Record<string, boolean> = {}\n  const flagConfigs: Record<string, Record<string, any>> = {}\n\n  if (query.data?.effective_flags) {\n    Object.entries(query.data.effective_flags).forEach(([flagKey, flagData]) => {\n      effectiveFlags[flagKey] = flagData.enabled\n      flagConfigs[flagKey] = flagData.config || {}\n    })\n  }\n\n  const getInheritanceChain = (flagKey: string) => {\n    if (!query.data?.inheritance_chain) return []\n    return query.data.inheritance_chain.filter(chain => chain.flag_key === flagKey)\n  }\n\n  return {\n    hierarchy: query.data || null,\n    effectiveFlags,\n    flagConfigs,\n    isLoading: query.isLoading,\n    error: query.error instanceof Error ? query.error : null,\n    getInheritanceChain,\n    refetch,\n  }\n}\n\n/**\n * Hook for checking specific module capabilities\n */\nexport function useModuleCapabilities(\n  moduleId: string,\n  capabilities: string[],\n  options: Pick<ModuleFeatureFlagOptions, 'cacheTime' | 'staleTime'> = {}\n) {\n  const { isAuthenticated } = useAuth()\n  const queryClient = useQueryClient()\n  \n  const mergedOptions = { ...DEFAULT_OPTIONS, ...options }\n  \n  const query = useQuery({\n    queryKey: moduleFeatureFlagKeys.capabilities(moduleId),\n    queryFn: () => moduleFeatureFlagApiService.checkModuleCapabilities(moduleId, capabilities),\n    enabled: isAuthenticated && !!moduleId && capabilities.length > 0,\n    cacheTime: mergedOptions.cacheTime,\n    staleTime: mergedOptions.staleTime,\n    onError: (error) => {\n      console.warn(`Module capabilities check failed for '${moduleId}':`, error)\n    },\n  })\n\n  const refetch = () => {\n    queryClient.invalidateQueries(moduleFeatureFlagKeys.capabilities(moduleId))\n    return query.refetch()\n  }\n\n  const hasCapability = (capability: string): boolean => {\n    return query.data?.[capability] || false\n  }\n\n  const getEnabledCapabilities = (): string[] => {\n    if (!query.data) return []\n    return Object.entries(query.data)\n      .filter(([, enabled]) => enabled)\n      .map(([capability]) => capability)\n  }\n\n  const getDisabledCapabilities = (): string[] => {\n    if (!query.data) return []\n    return Object.entries(query.data)\n      .filter(([, enabled]) => !enabled)\n      .map(([capability]) => capability)\n  }\n\n  return {\n    capabilities: query.data || {},\n    isLoading: query.isLoading,\n    error: query.error instanceof Error ? query.error : null,\n    hasCapability,\n    getEnabledCapabilities,\n    getDisabledCapabilities,\n    refetch,\n    lastUpdated: query.dataUpdatedAt ? new Date(query.dataUpdatedAt) : undefined,\n  }\n}\n\n/**\n * Hook for getting user's accessible modules (simplified module discovery)\n */\nexport function useAccessibleModules(\n  options: Pick<ModuleFeatureFlagOptions, 'cacheTime' | 'staleTime' | 'refetchInterval'> = {}\n) {\n  const { isAuthenticated } = useAuth()\n  const queryClient = useQueryClient()\n  \n  const mergedOptions = { ...DEFAULT_OPTIONS, ...options }\n  \n  const query = useQuery({\n    queryKey: moduleFeatureFlagKeys.accessible(),\n    queryFn: () => moduleFeatureFlagApiService.getUserAccessibleModules(),\n    enabled: isAuthenticated,\n    cacheTime: mergedOptions.cacheTime,\n    staleTime: mergedOptions.staleTime,\n    refetchInterval: mergedOptions.refetchInterval,\n    onError: (error) => {\n      console.warn('Accessible modules check failed:', error)\n    },\n  })\n\n  const refresh = () => {\n    queryClient.invalidateQueries(moduleFeatureFlagKeys.accessible())\n    return query.refetch()\n  }\n\n  return {\n    accessibleModules: query.data?.enabled_modules || [],\n    restrictedModules: query.data?.disabled_modules || [],\n    isLoading: query.isLoading,\n    error: query.error instanceof Error ? query.error : null,\n    refresh,\n    lastUpdated: query.dataUpdatedAt ? new Date(query.dataUpdatedAt) : undefined,\n  }\n}\n\n/**\n * Hook for module health monitoring including flag dependencies\n */\nexport function useModuleHealth(\n  moduleId: string,\n  options: Pick<ModuleFeatureFlagOptions, 'cacheTime' | 'staleTime' | 'refetchInterval'> = {}\n) {\n  const { isAuthenticated } = useAuth()\n  const queryClient = useQueryClient()\n  \n  const mergedOptions = { ...DEFAULT_OPTIONS, ...options }\n  \n  const query = useQuery({\n    queryKey: moduleFeatureFlagKeys.health(moduleId),\n    queryFn: () => moduleFeatureFlagApiService.getModuleHealth(moduleId),\n    enabled: isAuthenticated && !!moduleId,\n    cacheTime: mergedOptions.cacheTime,\n    staleTime: mergedOptions.staleTime,\n    refetchInterval: mergedOptions.refetchInterval || 60000, // Default 1min for health checks\n    onError: (error) => {\n      console.warn(`Module health check failed for '${moduleId}':`, error)\n    },\n  })\n\n  const refresh = () => {\n    queryClient.invalidateQueries(moduleFeatureFlagKeys.health(moduleId))\n    return query.refetch()\n  }\n\n  const isHealthy = (): boolean => {\n    return query.data?.status === 'healthy'\n  }\n\n  const isDegraded = (): boolean => {\n    return query.data?.status === 'degraded'\n  }\n\n  const isUnavailable = (): boolean => {\n    return query.data?.status === 'unavailable'\n  }\n\n  return {\n    health: query.data || null,\n    isLoading: query.isLoading,\n    error: query.error instanceof Error ? query.error : null,\n    isHealthy,\n    isDegraded,\n    isUnavailable,\n    refresh,\n    lastUpdated: query.dataUpdatedAt ? new Date(query.dataUpdatedAt) : undefined,\n  }\n}\n\n/**\n * Utility hook for module feature flag cache management\n */\nexport function useModuleFeatureFlagCache() {\n  const queryClient = useQueryClient()\n  \n  const invalidateModule = (moduleId: string) => {\n    queryClient.invalidateQueries(moduleFeatureFlagKeys.module(moduleId))\n    queryClient.invalidateQueries(moduleFeatureFlagKeys.hierarchy(moduleId))\n    queryClient.invalidateQueries(moduleFeatureFlagKeys.capabilities(moduleId))\n    queryClient.invalidateQueries(moduleFeatureFlagKeys.health(moduleId))\n  }\n\n  const invalidateAllModules = () => {\n    queryClient.invalidateQueries(moduleFeatureFlagKeys.all)\n  }\n\n  const invalidateDiscovery = () => {\n    queryClient.invalidateQueries(moduleFeatureFlagKeys.discovery())\n    queryClient.invalidateQueries(moduleFeatureFlagKeys.accessible())\n  }\n\n  const preloadModule = async (moduleId: string, capabilities: string[] = []) => {\n    try {\n      const promises = [\n        queryClient.prefetchQuery({\n          queryKey: moduleFeatureFlagKeys.hierarchy(moduleId),\n          queryFn: () => moduleFeatureFlagApiService.getModuleFlagHierarchy(moduleId),\n          staleTime: DEFAULT_OPTIONS.staleTime,\n        }),\n        queryClient.prefetchQuery({\n          queryKey: moduleFeatureFlagKeys.health(moduleId),\n          queryFn: () => moduleFeatureFlagApiService.getModuleHealth(moduleId),\n          staleTime: DEFAULT_OPTIONS.staleTime,\n        })\n      ]\n\n      if (capabilities.length > 0) {\n        promises.push(\n          queryClient.prefetchQuery({\n            queryKey: moduleFeatureFlagKeys.capabilities(moduleId),\n            queryFn: () => moduleFeatureFlagApiService.checkModuleCapabilities(moduleId, capabilities),\n            staleTime: DEFAULT_OPTIONS.staleTime,\n          })\n        )\n      }\n\n      await Promise.allSettled(promises)\n    } catch (error) {\n      console.warn(`Failed to preload module '${moduleId}':`, error)\n    }\n  }\n\n  return {\n    invalidateModule,\n    invalidateAllModules,\n    invalidateDiscovery,\n    preloadModule,\n  }\n}\n\n/**\n * Convenience hook that combines multiple module feature flag hooks\n */\nexport function useModuleDashboard(moduleId: string, capabilities: string[] = []) {\n  const moduleFlags = useModuleFeatureFlags()\n  const hierarchy = useModuleFlagHierarchy(moduleId)\n  const moduleCapabilities = useModuleCapabilities(moduleId, capabilities)\n  const health = useModuleHealth(moduleId)\n\n  const isModuleEnabled = moduleFlags.moduleFlags[moduleId] || false\n  const moduleConfig = moduleFlags.moduleConfigs[moduleId] || {}\n\n  return {\n    // Module state\n    isModuleEnabled,\n    moduleConfig,\n    \n    // Detailed data\n    flags: moduleFlags,\n    hierarchy,\n    capabilities: moduleCapabilities,\n    health,\n    \n    // Convenience methods\n    hasCapability: moduleCapabilities.hasCapability,\n    isHealthy: health.isHealthy,\n    \n    // Loading states\n    isLoading: moduleFlags.isLoading || hierarchy.isLoading || \n               moduleCapabilities.isLoading || health.isLoading,\n               \n    // Error states\n    hasError: !!(moduleFlags.error || hierarchy.error || \n                moduleCapabilities.error || health.error),\n                \n    // Refresh methods\n    refresh: () => {\n      moduleFlags.refetch()\n      hierarchy.refetch()\n      moduleCapabilities.refetch()\n      health.refresh()\n    }\n  }\n}"],"names":["moduleFeatureFlagKeys","useAccessibleModules","useModuleCapabilities","useModuleDashboard","useModuleDiscovery","useModuleFeatureFlagCache","useModuleFeatureFlags","useModuleFlagHierarchy","useModuleHealth","all","modules","module","moduleId","discovery","userId","hierarchy","capabilities","health","accessible","DEFAULT_OPTIONS","includeDisabled","moduleTypes","categories","requiredFlagsOnly","includeInherited","hierarchyDepth","cacheTime","staleTime","refetchInterval","preloadCapabilities","batchSize","options","user","isAuthenticated","useAuth","queryClient","useQueryClient","mergedOptions","query","useQuery","queryKey","queryFn","moduleFeatureFlagApiService","getModulesWithFlags","enabled","onError","error","console","warn","refetch","invalidateQueries","moduleFlags","moduleConfigs","enabledModules","disabledModules","moduleCapabilities","data","forEach","moduleData","id","hasRequiredFlags","required_flags","every","flagKey","enabled_flags","moduleEnabled","health_status","push","Object","entries","flagData","config","available_capabilities","isLoading","Error","lastUpdated","dataUpdatedAt","Date","undefined","effectiveUserId","discoverEnabledModules","organisation_id","refresh","enabled_modules","disabled_modules","totalAvailable","total_available","userAccessible","user_accessible","getModuleFlagHierarchy","effectiveFlags","flagConfigs","effective_flags","getInheritanceChain","inheritance_chain","filter","chain","flag_key","checkModuleCapabilities","length","hasCapability","capability","getEnabledCapabilities","map","getDisabledCapabilities","getUserAccessibleModules","accessibleModules","restrictedModules","getModuleHealth","isHealthy","status","isDegraded","isUnavailable","invalidateModule","invalidateAllModules","invalidateDiscovery","preloadModule","promises","prefetchQuery","Promise","allSettled","isModuleEnabled","moduleConfig","flags","hasError"],"mappings":"AAAA;;;;;;;;;;;;IAeaA,qBAAqB;eAArBA;;IA0QGC,oBAAoB;eAApBA;;IA3DAC,qBAAqB;eAArBA;;IAmNAC,kBAAkB;eAAlBA;;IAvTAC,kBAAkB;eAAlBA;;IA0PAC,yBAAyB;eAAzBA;;IAxUAC,qBAAqB;eAArBA;;IA2HAC,sBAAsB;eAAtBA;;IAwJAC,eAAe;eAAfA;;;4BA7TyB;yBACjB;sCACoB;AAWrC,MAAMR,wBAAwB;IACnCS,KAAK;QAAC;KAAqB;IAC3BC,SAAS,IAAM;YAAC;YAAsB;SAAU;IAChDC,QAAQ,CAACC,WAAqB;YAAC;YAAsB;YAAUA;SAAS;IACxEC,WAAW,CAACC,SAAoB;YAAC;YAAsB;YAAaA;SAAO;IAC3EC,WAAW,CAACH,WAAqB;YAAC;YAAsB;YAAaA;SAAS;IAC9EI,cAAc,CAACJ,WAAqB;YAAC;YAAsB;YAAgBA;SAAS;IACpFK,QAAQ,CAACL,WAAqB;YAAC;YAAsB;YAAUA;SAAS;IACxEM,YAAY,IAAM;YAAC;YAAsB;SAAa;AACxD;AAEA,kBAAkB;AAClB,MAAMC,kBAAsD;IAC1DC,iBAAiB;IACjBC,aAAa,EAAE;IACfC,YAAY,EAAE;IACdC,mBAAmB;IACnBC,kBAAkB;IAClBC,gBAAgB;IAChBC,WAAW,IAAI,KAAK;IACpBC,WAAW,IAAI,KAAK;IACpBC,iBAAiB;IACjBC,qBAAqB;IACrBC,WAAW;AACb;AAKO,SAASxB,sBACdyB,UAAoC,CAAC,CAAC;IAEtC,MAAM,EAAEC,IAAI,EAAEC,eAAe,EAAE,GAAGC,IAAAA,gBAAO;IACzC,MAAMC,cAAcC,IAAAA,0BAAc;IAElC,MAAMC,gBAAgB;QAAE,GAAGlB,eAAe;QAAE,GAAGY,OAAO;IAAC;IAEvD,MAAMO,QAAQC,IAAAA,oBAAQ,EAAC;QACrBC,UAAUxC,sBAAsBU,OAAO;QACvC+B,SAAS,IAAMC,iDAA2B,CAACC,mBAAmB;QAC9DC,SAASX;QACTP,WAAWW,cAAcX,SAAS;QAClCC,WAAWU,cAAcV,SAAS;QAClCC,iBAAiBS,cAAcT,eAAe;QAC9CiB,SAAS,CAACC;YACRC,QAAQC,IAAI,CAAC,sCAAsCF;QACrD;IACF;IAEA,MAAMG,UAAU;QACdd,YAAYe,iBAAiB,CAAClD,sBAAsBU,OAAO;QAC3D,OAAO4B,MAAMW,OAAO;IACtB;IAEA,4BAA4B;IAC5B,MAAME,cAAuC,CAAC;IAC9C,MAAMC,gBAAqD,CAAC;IAC5D,MAAMC,iBAA2B,EAAE;IACnC,MAAMC,kBAA4B,EAAE;IACpC,MAAMC,qBAA+C,CAAC;IAEtD,IAAIjB,MAAMkB,IAAI,EAAE;QACdlB,MAAMkB,IAAI,CAACC,OAAO,CAACC,CAAAA;YACjB,MAAM9C,WAAW8C,WAAW/C,MAAM,CAACgD,EAAE;YACrC,MAAMC,mBAAmBF,WAAW/C,MAAM,CAACkD,cAAc,CAACC,KAAK,CAC7DC,CAAAA,UAAWL,WAAWM,aAAa,CAACD,QAAQ,EAAEnB;YAGhD,sDAAsD;YACtD,MAAMqB,gBAAgBL,oBACpBF,WAAWQ,aAAa,KAAK;YAE/Bf,WAAW,CAACvC,SAAS,GAAGqD;YAExB,IAAIA,eAAe;gBACjBZ,eAAec,IAAI,CAACvD;YACtB,OAAO;gBACL0C,gBAAgBa,IAAI,CAACvD;YACvB;YAEA,gCAAgC;YAChCwC,aAAa,CAACxC,SAAS,GAAG,CAAC;YAC3BwD,OAAOC,OAAO,CAACX,WAAWM,aAAa,EAAEP,OAAO,CAAC,CAAC,CAACM,SAASO,SAAS;gBACnElB,aAAa,CAACxC,SAAS,CAACmD,QAAQ,GAAGO,SAASC,MAAM,IAAI,CAAC;YACzD;YAEA,uBAAuB;YACvBhB,kBAAkB,CAAC3C,SAAS,GAAG8C,WAAWc,sBAAsB;QAClE;IACF;IAEA,OAAO;QACLrB;QACAC;QACAqB,WAAWnC,MAAMmC,SAAS;QAC1B3B,OAAOR,MAAMQ,KAAK,YAAY4B,QAAQpC,MAAMQ,KAAK,GAAG;QACpDO;QACAC;QACAC;QACAN;QACA0B,aAAarC,MAAMsC,aAAa,GAAG,IAAIC,KAAKvC,MAAMsC,aAAa,IAAIE;IACrE;AACF;AAKO,SAAS1E,mBACdU,MAAe,EACfiB,UAA4D,CAAC,CAAC;IAE9D,MAAM,EAAEC,IAAI,EAAEC,eAAe,EAAE,GAAGC,IAAAA,gBAAO;IACzC,MAAMC,cAAcC,IAAAA,0BAAc;IAElC,MAAMC,gBAAgB;QAAE,GAAGlB,eAAe;QAAE,GAAGY,OAAO;IAAC;IACvD,MAAMgD,kBAAkBjE,UAAUkB,MAAM2B;IAExC,MAAMrB,QAAQC,IAAAA,oBAAQ,EAAC;QACrBC,UAAUxC,sBAAsBa,SAAS,CAACkE;QAC1CtC,SAAS,IAAMC,iDAA2B,CAACsC,sBAAsB,CAC/DD,iBACA/C,MAAMiD;QAERrC,SAASX;QACTP,WAAWW,cAAcX,SAAS;QAClCC,WAAWU,cAAcV,SAAS;QAClCC,iBAAiBS,cAAcT,eAAe;QAC9CiB,SAAS,CAACC;YACRC,QAAQC,IAAI,CAAC,4BAA4BF;QAC3C;IACF;IAEA,MAAMoC,UAAU;QACd/C,YAAYe,iBAAiB,CAAClD,sBAAsBa,SAAS,CAACkE;QAC9D,OAAOzC,MAAMW,OAAO;IACtB;IAEA,OAAO;QACLI,gBAAgBf,MAAMkB,IAAI,EAAE2B,mBAAmB,EAAE;QACjD7B,iBAAiBhB,MAAMkB,IAAI,EAAE4B,oBAAoB,EAAE;QACnDX,WAAWnC,MAAMmC,SAAS;QAC1B3B,OAAOR,MAAMQ,KAAK,YAAY4B,QAAQpC,MAAMQ,KAAK,GAAG;QACpDuC,gBAAgB/C,MAAMkB,IAAI,EAAE8B,mBAAmB;QAC/CC,gBAAgBjD,MAAMkB,IAAI,EAAEgC,mBAAmB;QAC/CN;QACAP,aAAarC,MAAMsC,aAAa,GAAG,IAAIC,KAAKvC,MAAMsC,aAAa,IAAIE;IACrE;AACF;AAKO,SAASvE,uBACdK,QAAgB,EAChBmB,UAA6G,CAAC,CAAC;IAE/G,MAAM,EAAEE,eAAe,EAAE,GAAGC,IAAAA,gBAAO;IACnC,MAAMC,cAAcC,IAAAA,0BAAc;IAElC,MAAMC,gBAAgB;QAAE,GAAGlB,eAAe;QAAE,GAAGY,OAAO;IAAC;IAEvD,MAAMO,QAAQC,IAAAA,oBAAQ,EAAC;QACrBC,UAAUxC,sBAAsBe,SAAS,CAACH;QAC1C6B,SAAS,IAAMC,iDAA2B,CAAC+C,sBAAsB,CAAC7E;QAClEgC,SAASX,mBAAmB,CAAC,CAACrB;QAC9Bc,WAAWW,cAAcX,SAAS;QAClCC,WAAWU,cAAcV,SAAS;QAClCkB,SAAS,CAACC;YACRC,QAAQC,IAAI,CAAC,CAAC,wCAAwC,EAAEpC,SAAS,EAAE,CAAC,EAAEkC;QACxE;IACF;IAEA,MAAMG,UAAU;QACdd,YAAYe,iBAAiB,CAAClD,sBAAsBe,SAAS,CAACH;QAC9D,OAAO0B,MAAMW,OAAO;IACtB;IAEA,sCAAsC;IACtC,MAAMyC,iBAA0C,CAAC;IACjD,MAAMC,cAAmD,CAAC;IAE1D,IAAIrD,MAAMkB,IAAI,EAAEoC,iBAAiB;QAC/BxB,OAAOC,OAAO,CAAC/B,MAAMkB,IAAI,CAACoC,eAAe,EAAEnC,OAAO,CAAC,CAAC,CAACM,SAASO,SAAS;YACrEoB,cAAc,CAAC3B,QAAQ,GAAGO,SAAS1B,OAAO;YAC1C+C,WAAW,CAAC5B,QAAQ,GAAGO,SAASC,MAAM,IAAI,CAAC;QAC7C;IACF;IAEA,MAAMsB,sBAAsB,CAAC9B;QAC3B,IAAI,CAACzB,MAAMkB,IAAI,EAAEsC,mBAAmB,OAAO,EAAE;QAC7C,OAAOxD,MAAMkB,IAAI,CAACsC,iBAAiB,CAACC,MAAM,CAACC,CAAAA,QAASA,MAAMC,QAAQ,KAAKlC;IACzE;IAEA,OAAO;QACLhD,WAAWuB,MAAMkB,IAAI,IAAI;QACzBkC;QACAC;QACAlB,WAAWnC,MAAMmC,SAAS;QAC1B3B,OAAOR,MAAMQ,KAAK,YAAY4B,QAAQpC,MAAMQ,KAAK,GAAG;QACpD+C;QACA5C;IACF;AACF;AAKO,SAAS/C,sBACdU,QAAgB,EAChBI,YAAsB,EACtBe,UAAqE,CAAC,CAAC;IAEvE,MAAM,EAAEE,eAAe,EAAE,GAAGC,IAAAA,gBAAO;IACnC,MAAMC,cAAcC,IAAAA,0BAAc;IAElC,MAAMC,gBAAgB;QAAE,GAAGlB,eAAe;QAAE,GAAGY,OAAO;IAAC;IAEvD,MAAMO,QAAQC,IAAAA,oBAAQ,EAAC;QACrBC,UAAUxC,sBAAsBgB,YAAY,CAACJ;QAC7C6B,SAAS,IAAMC,iDAA2B,CAACwD,uBAAuB,CAACtF,UAAUI;QAC7E4B,SAASX,mBAAmB,CAAC,CAACrB,YAAYI,aAAamF,MAAM,GAAG;QAChEzE,WAAWW,cAAcX,SAAS;QAClCC,WAAWU,cAAcV,SAAS;QAClCkB,SAAS,CAACC;YACRC,QAAQC,IAAI,CAAC,CAAC,sCAAsC,EAAEpC,SAAS,EAAE,CAAC,EAAEkC;QACtE;IACF;IAEA,MAAMG,UAAU;QACdd,YAAYe,iBAAiB,CAAClD,sBAAsBgB,YAAY,CAACJ;QACjE,OAAO0B,MAAMW,OAAO;IACtB;IAEA,MAAMmD,gBAAgB,CAACC;QACrB,OAAO/D,MAAMkB,IAAI,EAAE,CAAC6C,WAAW,IAAI;IACrC;IAEA,MAAMC,yBAAyB;QAC7B,IAAI,CAAChE,MAAMkB,IAAI,EAAE,OAAO,EAAE;QAC1B,OAAOY,OAAOC,OAAO,CAAC/B,MAAMkB,IAAI,EAC7BuC,MAAM,CAAC,CAAC,GAAGnD,QAAQ,GAAKA,SACxB2D,GAAG,CAAC,CAAC,CAACF,WAAW,GAAKA;IAC3B;IAEA,MAAMG,0BAA0B;QAC9B,IAAI,CAAClE,MAAMkB,IAAI,EAAE,OAAO,EAAE;QAC1B,OAAOY,OAAOC,OAAO,CAAC/B,MAAMkB,IAAI,EAC7BuC,MAAM,CAAC,CAAC,GAAGnD,QAAQ,GAAK,CAACA,SACzB2D,GAAG,CAAC,CAAC,CAACF,WAAW,GAAKA;IAC3B;IAEA,OAAO;QACLrF,cAAcsB,MAAMkB,IAAI,IAAI,CAAC;QAC7BiB,WAAWnC,MAAMmC,SAAS;QAC1B3B,OAAOR,MAAMQ,KAAK,YAAY4B,QAAQpC,MAAMQ,KAAK,GAAG;QACpDsD;QACAE;QACAE;QACAvD;QACA0B,aAAarC,MAAMsC,aAAa,GAAG,IAAIC,KAAKvC,MAAMsC,aAAa,IAAIE;IACrE;AACF;AAKO,SAAS7E,qBACd8B,UAAyF,CAAC,CAAC;IAE3F,MAAM,EAAEE,eAAe,EAAE,GAAGC,IAAAA,gBAAO;IACnC,MAAMC,cAAcC,IAAAA,0BAAc;IAElC,MAAMC,gBAAgB;QAAE,GAAGlB,eAAe;QAAE,GAAGY,OAAO;IAAC;IAEvD,MAAMO,QAAQC,IAAAA,oBAAQ,EAAC;QACrBC,UAAUxC,sBAAsBkB,UAAU;QAC1CuB,SAAS,IAAMC,iDAA2B,CAAC+D,wBAAwB;QACnE7D,SAASX;QACTP,WAAWW,cAAcX,SAAS;QAClCC,WAAWU,cAAcV,SAAS;QAClCC,iBAAiBS,cAAcT,eAAe;QAC9CiB,SAAS,CAACC;YACRC,QAAQC,IAAI,CAAC,oCAAoCF;QACnD;IACF;IAEA,MAAMoC,UAAU;QACd/C,YAAYe,iBAAiB,CAAClD,sBAAsBkB,UAAU;QAC9D,OAAOoB,MAAMW,OAAO;IACtB;IAEA,OAAO;QACLyD,mBAAmBpE,MAAMkB,IAAI,EAAE2B,mBAAmB,EAAE;QACpDwB,mBAAmBrE,MAAMkB,IAAI,EAAE4B,oBAAoB,EAAE;QACrDX,WAAWnC,MAAMmC,SAAS;QAC1B3B,OAAOR,MAAMQ,KAAK,YAAY4B,QAAQpC,MAAMQ,KAAK,GAAG;QACpDoC;QACAP,aAAarC,MAAMsC,aAAa,GAAG,IAAIC,KAAKvC,MAAMsC,aAAa,IAAIE;IACrE;AACF;AAKO,SAAStE,gBACdI,QAAgB,EAChBmB,UAAyF,CAAC,CAAC;IAE3F,MAAM,EAAEE,eAAe,EAAE,GAAGC,IAAAA,gBAAO;IACnC,MAAMC,cAAcC,IAAAA,0BAAc;IAElC,MAAMC,gBAAgB;QAAE,GAAGlB,eAAe;QAAE,GAAGY,OAAO;IAAC;IAEvD,MAAMO,QAAQC,IAAAA,oBAAQ,EAAC;QACrBC,UAAUxC,sBAAsBiB,MAAM,CAACL;QACvC6B,SAAS,IAAMC,iDAA2B,CAACkE,eAAe,CAAChG;QAC3DgC,SAASX,mBAAmB,CAAC,CAACrB;QAC9Bc,WAAWW,cAAcX,SAAS;QAClCC,WAAWU,cAAcV,SAAS;QAClCC,iBAAiBS,cAAcT,eAAe,IAAI;QAClDiB,SAAS,CAACC;YACRC,QAAQC,IAAI,CAAC,CAAC,gCAAgC,EAAEpC,SAAS,EAAE,CAAC,EAAEkC;QAChE;IACF;IAEA,MAAMoC,UAAU;QACd/C,YAAYe,iBAAiB,CAAClD,sBAAsBiB,MAAM,CAACL;QAC3D,OAAO0B,MAAMW,OAAO;IACtB;IAEA,MAAM4D,YAAY;QAChB,OAAOvE,MAAMkB,IAAI,EAAEsD,WAAW;IAChC;IAEA,MAAMC,aAAa;QACjB,OAAOzE,MAAMkB,IAAI,EAAEsD,WAAW;IAChC;IAEA,MAAME,gBAAgB;QACpB,OAAO1E,MAAMkB,IAAI,EAAEsD,WAAW;IAChC;IAEA,OAAO;QACL7F,QAAQqB,MAAMkB,IAAI,IAAI;QACtBiB,WAAWnC,MAAMmC,SAAS;QAC1B3B,OAAOR,MAAMQ,KAAK,YAAY4B,QAAQpC,MAAMQ,KAAK,GAAG;QACpD+D;QACAE;QACAC;QACA9B;QACAP,aAAarC,MAAMsC,aAAa,GAAG,IAAIC,KAAKvC,MAAMsC,aAAa,IAAIE;IACrE;AACF;AAKO,SAASzE;IACd,MAAM8B,cAAcC,IAAAA,0BAAc;IAElC,MAAM6E,mBAAmB,CAACrG;QACxBuB,YAAYe,iBAAiB,CAAClD,sBAAsBW,MAAM,CAACC;QAC3DuB,YAAYe,iBAAiB,CAAClD,sBAAsBe,SAAS,CAACH;QAC9DuB,YAAYe,iBAAiB,CAAClD,sBAAsBgB,YAAY,CAACJ;QACjEuB,YAAYe,iBAAiB,CAAClD,sBAAsBiB,MAAM,CAACL;IAC7D;IAEA,MAAMsG,uBAAuB;QAC3B/E,YAAYe,iBAAiB,CAAClD,sBAAsBS,GAAG;IACzD;IAEA,MAAM0G,sBAAsB;QAC1BhF,YAAYe,iBAAiB,CAAClD,sBAAsBa,SAAS;QAC7DsB,YAAYe,iBAAiB,CAAClD,sBAAsBkB,UAAU;IAChE;IAEA,MAAMkG,gBAAgB,OAAOxG,UAAkBI,eAAyB,EAAE;QACxE,IAAI;YACF,MAAMqG,WAAW;gBACflF,YAAYmF,aAAa,CAAC;oBACxB9E,UAAUxC,sBAAsBe,SAAS,CAACH;oBAC1C6B,SAAS,IAAMC,iDAA2B,CAAC+C,sBAAsB,CAAC7E;oBAClEe,WAAWR,gBAAgBQ,SAAS;gBACtC;gBACAQ,YAAYmF,aAAa,CAAC;oBACxB9E,UAAUxC,sBAAsBiB,MAAM,CAACL;oBACvC6B,SAAS,IAAMC,iDAA2B,CAACkE,eAAe,CAAChG;oBAC3De,WAAWR,gBAAgBQ,SAAS;gBACtC;aACD;YAED,IAAIX,aAAamF,MAAM,GAAG,GAAG;gBAC3BkB,SAASlD,IAAI,CACXhC,YAAYmF,aAAa,CAAC;oBACxB9E,UAAUxC,sBAAsBgB,YAAY,CAACJ;oBAC7C6B,SAAS,IAAMC,iDAA2B,CAACwD,uBAAuB,CAACtF,UAAUI;oBAC7EW,WAAWR,gBAAgBQ,SAAS;gBACtC;YAEJ;YAEA,MAAM4F,QAAQC,UAAU,CAACH;QAC3B,EAAE,OAAOvE,OAAO;YACdC,QAAQC,IAAI,CAAC,CAAC,0BAA0B,EAAEpC,SAAS,EAAE,CAAC,EAAEkC;QAC1D;IACF;IAEA,OAAO;QACLmE;QACAC;QACAC;QACAC;IACF;AACF;AAKO,SAASjH,mBAAmBS,QAAgB,EAAEI,eAAyB,EAAE;IAC9E,MAAMmC,cAAc7C;IACpB,MAAMS,YAAYR,uBAAuBK;IACzC,MAAM2C,qBAAqBrD,sBAAsBU,UAAUI;IAC3D,MAAMC,SAAST,gBAAgBI;IAE/B,MAAM6G,kBAAkBtE,YAAYA,WAAW,CAACvC,SAAS,IAAI;IAC7D,MAAM8G,eAAevE,YAAYC,aAAa,CAACxC,SAAS,IAAI,CAAC;IAE7D,OAAO;QACL,eAAe;QACf6G;QACAC;QAEA,gBAAgB;QAChBC,OAAOxE;QACPpC;QACAC,cAAcuC;QACdtC;QAEA,sBAAsB;QACtBmF,eAAe7C,mBAAmB6C,aAAa;QAC/CS,WAAW5F,OAAO4F,SAAS;QAE3B,iBAAiB;QACjBpC,WAAWtB,YAAYsB,SAAS,IAAI1D,UAAU0D,SAAS,IAC5ClB,mBAAmBkB,SAAS,IAAIxD,OAAOwD,SAAS;QAE3D,eAAe;QACfmD,UAAU,CAAC,CAAEzE,CAAAA,YAAYL,KAAK,IAAI/B,UAAU+B,KAAK,IACrCS,mBAAmBT,KAAK,IAAI7B,OAAO6B,KAAK,AAAD;QAEnD,kBAAkB;QAClBoC,SAAS;YACP/B,YAAYF,OAAO;YACnBlC,UAAUkC,OAAO;YACjBM,mBAAmBN,OAAO;YAC1BhC,OAAOiE,OAAO;QAChB;IACF;AACF"}