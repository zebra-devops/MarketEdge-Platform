834d23b1c19cfb071122c18171146ced
"use client";
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: all[name]
    });
}
_export(exports, {
    OrganisationProvider: function() {
        return OrganisationProvider;
    },
    useOrganisationContext: function() {
        return useOrganisationContext;
    }
});
const _jsxruntime = require("react/jsx-runtime");
const _react = /*#__PURE__*/ _interop_require_wildcard(require("react"));
const _api = require("../../services/api");
const _auth = require("../../services/auth");
const _useAuth = require("../../hooks/useAuth");
function _getRequireWildcardCache(nodeInterop) {
    if (typeof WeakMap !== "function") return null;
    var cacheBabelInterop = new WeakMap();
    var cacheNodeInterop = new WeakMap();
    return (_getRequireWildcardCache = function(nodeInterop) {
        return nodeInterop ? cacheNodeInterop : cacheBabelInterop;
    })(nodeInterop);
}
function _interop_require_wildcard(obj, nodeInterop) {
    if (!nodeInterop && obj && obj.__esModule) {
        return obj;
    }
    if (obj === null || typeof obj !== "object" && typeof obj !== "function") {
        return {
            default: obj
        };
    }
    var cache = _getRequireWildcardCache(nodeInterop);
    if (cache && cache.has(obj)) {
        return cache.get(obj);
    }
    var newObj = {
        __proto__: null
    };
    var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;
    for(var key in obj){
        if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) {
            var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;
            if (desc && (desc.get || desc.set)) {
                Object.defineProperty(newObj, key, desc);
            } else {
                newObj[key] = obj[key];
            }
        }
    }
    newObj.default = obj;
    if (cache) {
        cache.set(obj, newObj);
    }
    return newObj;
}
const OrganisationContext = /*#__PURE__*/ (0, _react.createContext)(undefined);
const useOrganisationContext = ()=>{
    const context = (0, _react.useContext)(OrganisationContext);
    if (!context) {
        throw new Error("useOrganisationContext must be used within an OrganisationProvider");
    }
    return context;
};
const OrganisationProvider = ({ children })=>{
    const { user, isAuthenticated, hasRole } = (0, _useAuth.useAuthContext)();
    const [currentOrganisation, setCurrentOrganisation] = (0, _react.useState)(null);
    const [allOrganisations, setAllOrganisations] = (0, _react.useState)([]);
    const [availableIndustries, setAvailableIndustries] = (0, _react.useState)([]);
    const [accessibleOrganisations, setAccessibleOrganisations] = (0, _react.useState)([]);
    const [isLoadingCurrent, setIsLoadingCurrent] = (0, _react.useState)(false);
    const [isLoadingAll, setIsLoadingAll] = (0, _react.useState)(false);
    const [isLoadingIndustries, setIsLoadingIndustries] = (0, _react.useState)(false);
    const [isLoadingAccessible, setIsLoadingAccessible] = (0, _react.useState)(false);
    const [isSwitching, setIsSwitching] = (0, _react.useState)(false);
    // Stabilize isSuperAdmin to prevent infinite loops
    const [isSuperAdmin, setIsSuperAdmin] = (0, _react.useState)(false);
    const [canManageOrganisations, setCanManageOrganisations] = (0, _react.useState)(false);
    const [lastLoadTime, setLastLoadTime] = (0, _react.useState)(0);
    // Update admin status when user changes
    (0, _react.useEffect)(()=>{
        const adminStatus = hasRole("admin");
        setIsSuperAdmin(adminStatus);
        setCanManageOrganisations(adminStatus);
    }, [
        user?.id,
        user?.role
    ]) // Only depend on stable user properties
    ;
    // Load selected organization from localStorage on mount
    (0, _react.useEffect)(()=>{
        if (typeof window !== "undefined") {
            const savedOrgId = localStorage.getItem("selectedOrganisationId");
            if (savedOrgId && currentOrganisation?.id !== savedOrgId) {
            // Will be loaded when organizations are fetched
            }
        }
    }, []);
    (0, _react.useEffect)(()=>{
        // Circuit breaker: prevent rapid successive calls
        const now = Date.now();
        if (now - lastLoadTime < 2000) {
            console.warn("OrganisationProvider: Rate limited, skipping load");
            return;
        }
        // Only proceed if fully authenticated and tokens are available
        if (isAuthenticated && user && _auth.authService.getToken()) {
            console.log("OrganisationProvider: Loading organization data for authenticated user");
            setLastLoadTime(now);
            // Always load industries
            loadAvailableIndustries();
            // Load accessible organizations for all users
            refreshAccessibleOrganisations();
            // Load current organisation for regular users
            if (!isSuperAdmin) {
                refreshCurrentOrganisation();
            }
            // Load all organisations for super admins
            if (isSuperAdmin) {
                refreshAllOrganisations();
            }
        } else if (isAuthenticated && user && !_auth.authService.getToken()) {
            console.warn("OrganisationProvider: User authenticated but no token available, skipping organization data load");
        }
    }, [
        isAuthenticated,
        user?.id,
        isSuperAdmin
    ]) // Use stable user.id instead of full user object
    ;
    const loadAvailableIndustries = async ()=>{
        try {
            setIsLoadingIndustries(true);
            const industries = await _api.apiService.getAvailableIndustries();
            setAvailableIndustries(industries);
        } catch (error) {
            console.error("Failed to load industries:", error);
        } finally{
            setIsLoadingIndustries(false);
        }
    };
    const refreshCurrentOrganisation = async ()=>{
        if (!isAuthenticated || !_auth.authService.getToken()) {
            console.warn("Cannot load current organisation: not authenticated or no token");
            return;
        }
        try {
            setIsLoadingCurrent(true);
            const organisation = await _api.apiService.getCurrentOrganisation();
            setCurrentOrganisation(organisation);
        } catch (error) {
            console.error("Failed to load current organisation:", error);
            // If it's an authentication error, don't show it as a critical error
            if (error?.response?.status === 401 || error?.response?.status === 403) {
                console.warn("Authentication issue loading current organisation, user may need to re-login");
            }
            setCurrentOrganisation(null);
        } finally{
            setIsLoadingCurrent(false);
        }
    };
    const refreshAllOrganisations = async ()=>{
        if (!isSuperAdmin || !isAuthenticated || !_auth.authService.getToken()) {
            console.warn("Cannot load all organisations: not super admin, not authenticated, or no token");
            return;
        }
        try {
            setIsLoadingAll(true);
            const organisations = await _api.apiService.getAllOrganisations();
            setAllOrganisations(organisations);
        } catch (error) {
            console.error("Failed to load all organisations:", error);
            // If it's an authentication error, don't show it as a critical error
            if (error?.response?.status === 401 || error?.response?.status === 403) {
                console.warn("Authentication issue loading all organisations, user may need to re-login");
            }
            setAllOrganisations([]);
        } finally{
            setIsLoadingAll(false);
        }
    };
    const createOrganisation = async (data)=>{
        if (!isSuperAdmin) {
            throw new Error("Only Super Admins can create organisations");
        }
        try {
            const newOrganisation = await _api.apiService.createOrganisation(data);
            // Refresh the list after creation
            await refreshAllOrganisations();
            await refreshAccessibleOrganisations();
            return newOrganisation;
        } catch (error) {
            console.error("Failed to create organisation:", error);
            throw error;
        }
    };
    const refreshAccessibleOrganisations = async ()=>{
        if (!isAuthenticated || !_auth.authService.getToken()) {
            console.warn("Cannot load accessible organisations: not authenticated or no token");
            return;
        }
        try {
            setIsLoadingAccessible(true);
            // For Super Admin, accessible orgs are all orgs
            if (isSuperAdmin) {
                const organisations = await _api.apiService.getAllOrganisations();
                setAccessibleOrganisations(organisations);
            } else {
                // For regular users, get organizations they have access to
                const organisations = await _api.apiService.getUserAccessibleOrganisations();
                setAccessibleOrganisations(organisations);
            }
        } catch (error) {
            console.error("Failed to load accessible organisations:", error);
            // If it's an authentication error, don't show it as a critical error
            if (error?.response?.status === 401 || error?.response?.status === 403) {
                console.warn("Authentication issue loading organisations, user may need to re-login");
            } else if (error?.response?.status === 400) {
                console.error("Backend API error: organisations/accessible endpoint has implementation issues");
                console.warn("This is likely a backend bug - missing service method or incorrect role comparison");
            // For now, fallback to empty list to prevent app crash
            }
            setAccessibleOrganisations([]);
        } finally{
            setIsLoadingAccessible(false);
        }
    };
    const switchOrganisation = async (orgId)=>{
        if (!isAuthenticated) return;
        try {
            setIsSwitching(true);
            // Validate user has access to this organization
            const hasAccess = accessibleOrganisations.some((org)=>org.id === orgId);
            if (!hasAccess) {
                throw new Error("You do not have access to this organization");
            }
            // Clear any cached data from previous organization context
            if (typeof window !== "undefined") {
                // Clear any organization-specific cache keys
                const keysToRemove = [];
                for(let i = 0; i < localStorage.length; i++){
                    const key = localStorage.key(i);
                    if (key && (key.includes("org_") || key.includes("tenant_"))) {
                        keysToRemove.push(key);
                    }
                }
                keysToRemove.forEach((key)=>localStorage.removeItem(key));
            }
            // Set the new organization context
            const targetOrg = accessibleOrganisations.find((org)=>org.id === orgId);
            if (targetOrg) {
                setCurrentOrganisation(targetOrg);
                // Persist selection
                if (typeof window !== "undefined") {
                    localStorage.setItem("selectedOrganisationId", orgId);
                }
                // Update API service organization context
                _api.apiService.setOrganizationContext(orgId);
                // Audit log the organization switch
                try {
                    await _api.apiService.logOrganizationSwitch(orgId);
                } catch (auditError) {
                    console.warn("Failed to log organization switch:", auditError);
                // Don't fail the switch if audit logging fails
                }
                // Trigger data refresh for current page
                window.dispatchEvent(new CustomEvent("organizationChanged", {
                    detail: {
                        organizationId: orgId,
                        organization: targetOrg
                    }
                }));
            }
        } catch (error) {
            console.error("Failed to switch organisation:", error);
            throw error;
        } finally{
            setIsSwitching(false);
        }
    };
    const contextValue = {
        currentOrganisation,
        allOrganisations,
        availableIndustries,
        accessibleOrganisations,
        isLoadingCurrent,
        isLoadingAll,
        isLoadingIndustries,
        isLoadingAccessible,
        isSwitching,
        refreshCurrentOrganisation,
        refreshAllOrganisations,
        createOrganisation,
        switchOrganisation,
        refreshAccessibleOrganisations,
        canManageOrganisations,
        isSuperAdmin
    };
    return /*#__PURE__*/ (0, _jsxruntime.jsx)(OrganisationContext.Provider, {
        value: contextValue,
        children: children
    });
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9tYXR0L1NpdGVzL01hcmtldEVkZ2UvcGxhdGZvcm0td3JhcHBlci9mcm9udGVuZC9zcmMvY29tcG9uZW50cy9wcm92aWRlcnMvT3JnYW5pc2F0aW9uUHJvdmlkZXIudHN4Il0sInNvdXJjZXNDb250ZW50IjpbIid1c2UgY2xpZW50J1xuXG5pbXBvcnQgUmVhY3QsIHsgY3JlYXRlQ29udGV4dCwgdXNlQ29udGV4dCwgdXNlU3RhdGUsIHVzZUVmZmVjdCB9IGZyb20gJ3JlYWN0J1xuaW1wb3J0IHsgT3JnYW5pc2F0aW9uLCBJbmR1c3RyeU9wdGlvbiB9IGZyb20gJ0AvdHlwZXMvYXBpJ1xuaW1wb3J0IHsgYXBpU2VydmljZSB9IGZyb20gJ0Avc2VydmljZXMvYXBpJ1xuaW1wb3J0IHsgYXV0aFNlcnZpY2UgfSBmcm9tICdAL3NlcnZpY2VzL2F1dGgnXG5pbXBvcnQgeyB1c2VBdXRoQ29udGV4dCB9IGZyb20gJ0AvaG9va3MvdXNlQXV0aCdcblxuaW50ZXJmYWNlIE9yZ2FuaXNhdGlvbkNvbnRleHRUeXBlIHtcbiAgLy8gQ3VycmVudCB1c2VyJ3Mgb3JnYW5pc2F0aW9uXG4gIGN1cnJlbnRPcmdhbmlzYXRpb246IE9yZ2FuaXNhdGlvbiB8IG51bGxcbiAgXG4gIC8vIEFsbCBvcmdhbmlzYXRpb25zIChTdXBlciBBZG1pbiBvbmx5KVxuICBhbGxPcmdhbmlzYXRpb25zOiBPcmdhbmlzYXRpb25bXVxuICBcbiAgLy8gQXZhaWxhYmxlIGluZHVzdHJpZXNcbiAgYXZhaWxhYmxlSW5kdXN0cmllczogSW5kdXN0cnlPcHRpb25bXVxuICBcbiAgLy8gT3JnYW5pemF0aW9ucyB1c2VyIGhhcyBhY2Nlc3MgdG9cbiAgYWNjZXNzaWJsZU9yZ2FuaXNhdGlvbnM6IE9yZ2FuaXNhdGlvbltdXG4gIFxuICAvLyBMb2FkaW5nIHN0YXRlc1xuICBpc0xvYWRpbmdDdXJyZW50OiBib29sZWFuXG4gIGlzTG9hZGluZ0FsbDogYm9vbGVhblxuICBpc0xvYWRpbmdJbmR1c3RyaWVzOiBib29sZWFuXG4gIGlzTG9hZGluZ0FjY2Vzc2libGU6IGJvb2xlYW5cbiAgaXNTd2l0Y2hpbmc6IGJvb2xlYW5cbiAgXG4gIC8vIEFjdGlvbnNcbiAgcmVmcmVzaEN1cnJlbnRPcmdhbmlzYXRpb246ICgpID0+IFByb21pc2U8dm9pZD5cbiAgcmVmcmVzaEFsbE9yZ2FuaXNhdGlvbnM6ICgpID0+IFByb21pc2U8dm9pZD5cbiAgY3JlYXRlT3JnYW5pc2F0aW9uOiAoZGF0YTogYW55KSA9PiBQcm9taXNlPE9yZ2FuaXNhdGlvbj5cbiAgc3dpdGNoT3JnYW5pc2F0aW9uOiAob3JnSWQ6IHN0cmluZykgPT4gUHJvbWlzZTx2b2lkPlxuICByZWZyZXNoQWNjZXNzaWJsZU9yZ2FuaXNhdGlvbnM6ICgpID0+IFByb21pc2U8dm9pZD5cbiAgXG4gIC8vIFV0aWxpdGllc1xuICBjYW5NYW5hZ2VPcmdhbmlzYXRpb25zOiBib29sZWFuXG4gIGlzU3VwZXJBZG1pbjogYm9vbGVhblxufVxuXG5jb25zdCBPcmdhbmlzYXRpb25Db250ZXh0ID0gY3JlYXRlQ29udGV4dDxPcmdhbmlzYXRpb25Db250ZXh0VHlwZSB8IHVuZGVmaW5lZD4odW5kZWZpbmVkKVxuXG5leHBvcnQgY29uc3QgdXNlT3JnYW5pc2F0aW9uQ29udGV4dCA9ICgpOiBPcmdhbmlzYXRpb25Db250ZXh0VHlwZSA9PiB7XG4gIGNvbnN0IGNvbnRleHQgPSB1c2VDb250ZXh0KE9yZ2FuaXNhdGlvbkNvbnRleHQpXG4gIGlmICghY29udGV4dCkge1xuICAgIHRocm93IG5ldyBFcnJvcigndXNlT3JnYW5pc2F0aW9uQ29udGV4dCBtdXN0IGJlIHVzZWQgd2l0aGluIGFuIE9yZ2FuaXNhdGlvblByb3ZpZGVyJylcbiAgfVxuICByZXR1cm4gY29udGV4dFxufVxuXG5pbnRlcmZhY2UgT3JnYW5pc2F0aW9uUHJvdmlkZXJQcm9wcyB7XG4gIGNoaWxkcmVuOiBSZWFjdC5SZWFjdE5vZGVcbn1cblxuZXhwb3J0IGNvbnN0IE9yZ2FuaXNhdGlvblByb3ZpZGVyOiBSZWFjdC5GQzxPcmdhbmlzYXRpb25Qcm92aWRlclByb3BzPiA9ICh7IGNoaWxkcmVuIH0pID0+IHtcbiAgY29uc3QgeyB1c2VyLCBpc0F1dGhlbnRpY2F0ZWQsIGhhc1JvbGUgfSA9IHVzZUF1dGhDb250ZXh0KClcbiAgXG4gIGNvbnN0IFtjdXJyZW50T3JnYW5pc2F0aW9uLCBzZXRDdXJyZW50T3JnYW5pc2F0aW9uXSA9IHVzZVN0YXRlPE9yZ2FuaXNhdGlvbiB8IG51bGw+KG51bGwpXG4gIGNvbnN0IFthbGxPcmdhbmlzYXRpb25zLCBzZXRBbGxPcmdhbmlzYXRpb25zXSA9IHVzZVN0YXRlPE9yZ2FuaXNhdGlvbltdPihbXSlcbiAgY29uc3QgW2F2YWlsYWJsZUluZHVzdHJpZXMsIHNldEF2YWlsYWJsZUluZHVzdHJpZXNdID0gdXNlU3RhdGU8SW5kdXN0cnlPcHRpb25bXT4oW10pXG4gIGNvbnN0IFthY2Nlc3NpYmxlT3JnYW5pc2F0aW9ucywgc2V0QWNjZXNzaWJsZU9yZ2FuaXNhdGlvbnNdID0gdXNlU3RhdGU8T3JnYW5pc2F0aW9uW10+KFtdKVxuICBcbiAgY29uc3QgW2lzTG9hZGluZ0N1cnJlbnQsIHNldElzTG9hZGluZ0N1cnJlbnRdID0gdXNlU3RhdGUoZmFsc2UpXG4gIGNvbnN0IFtpc0xvYWRpbmdBbGwsIHNldElzTG9hZGluZ0FsbF0gPSB1c2VTdGF0ZShmYWxzZSlcbiAgY29uc3QgW2lzTG9hZGluZ0luZHVzdHJpZXMsIHNldElzTG9hZGluZ0luZHVzdHJpZXNdID0gdXNlU3RhdGUoZmFsc2UpXG4gIGNvbnN0IFtpc0xvYWRpbmdBY2Nlc3NpYmxlLCBzZXRJc0xvYWRpbmdBY2Nlc3NpYmxlXSA9IHVzZVN0YXRlKGZhbHNlKVxuICBjb25zdCBbaXNTd2l0Y2hpbmcsIHNldElzU3dpdGNoaW5nXSA9IHVzZVN0YXRlKGZhbHNlKVxuXG4gIC8vIFN0YWJpbGl6ZSBpc1N1cGVyQWRtaW4gdG8gcHJldmVudCBpbmZpbml0ZSBsb29wc1xuICBjb25zdCBbaXNTdXBlckFkbWluLCBzZXRJc1N1cGVyQWRtaW5dID0gdXNlU3RhdGUoZmFsc2UpXG4gIGNvbnN0IFtjYW5NYW5hZ2VPcmdhbmlzYXRpb25zLCBzZXRDYW5NYW5hZ2VPcmdhbmlzYXRpb25zXSA9IHVzZVN0YXRlKGZhbHNlKVxuICBjb25zdCBbbGFzdExvYWRUaW1lLCBzZXRMYXN0TG9hZFRpbWVdID0gdXNlU3RhdGUoMClcbiAgXG4gIC8vIFVwZGF0ZSBhZG1pbiBzdGF0dXMgd2hlbiB1c2VyIGNoYW5nZXNcbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICBjb25zdCBhZG1pblN0YXR1cyA9IGhhc1JvbGUoJ2FkbWluJylcbiAgICBzZXRJc1N1cGVyQWRtaW4oYWRtaW5TdGF0dXMpXG4gICAgc2V0Q2FuTWFuYWdlT3JnYW5pc2F0aW9ucyhhZG1pblN0YXR1cylcbiAgfSwgW3VzZXI/LmlkLCB1c2VyPy5yb2xlXSkgLy8gT25seSBkZXBlbmQgb24gc3RhYmxlIHVzZXIgcHJvcGVydGllc1xuXG4gIC8vIExvYWQgc2VsZWN0ZWQgb3JnYW5pemF0aW9uIGZyb20gbG9jYWxTdG9yYWdlIG9uIG1vdW50XG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICBjb25zdCBzYXZlZE9yZ0lkID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3NlbGVjdGVkT3JnYW5pc2F0aW9uSWQnKVxuICAgICAgaWYgKHNhdmVkT3JnSWQgJiYgY3VycmVudE9yZ2FuaXNhdGlvbj8uaWQgIT09IHNhdmVkT3JnSWQpIHtcbiAgICAgICAgLy8gV2lsbCBiZSBsb2FkZWQgd2hlbiBvcmdhbml6YXRpb25zIGFyZSBmZXRjaGVkXG4gICAgICB9XG4gICAgfVxuICB9LCBbXSlcblxuICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgIC8vIENpcmN1aXQgYnJlYWtlcjogcHJldmVudCByYXBpZCBzdWNjZXNzaXZlIGNhbGxzXG4gICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKVxuICAgIGlmIChub3cgLSBsYXN0TG9hZFRpbWUgPCAyMDAwKSB7IC8vIDIgc2Vjb25kIGNvb2xkb3duXG4gICAgICBjb25zb2xlLndhcm4oJ09yZ2FuaXNhdGlvblByb3ZpZGVyOiBSYXRlIGxpbWl0ZWQsIHNraXBwaW5nIGxvYWQnKVxuICAgICAgcmV0dXJuXG4gICAgfVxuICAgIFxuICAgIC8vIE9ubHkgcHJvY2VlZCBpZiBmdWxseSBhdXRoZW50aWNhdGVkIGFuZCB0b2tlbnMgYXJlIGF2YWlsYWJsZVxuICAgIGlmIChpc0F1dGhlbnRpY2F0ZWQgJiYgdXNlciAmJiBhdXRoU2VydmljZS5nZXRUb2tlbigpKSB7XG4gICAgICBjb25zb2xlLmxvZygnT3JnYW5pc2F0aW9uUHJvdmlkZXI6IExvYWRpbmcgb3JnYW5pemF0aW9uIGRhdGEgZm9yIGF1dGhlbnRpY2F0ZWQgdXNlcicpXG4gICAgICBzZXRMYXN0TG9hZFRpbWUobm93KVxuICAgICAgXG4gICAgICAvLyBBbHdheXMgbG9hZCBpbmR1c3RyaWVzXG4gICAgICBsb2FkQXZhaWxhYmxlSW5kdXN0cmllcygpXG4gICAgICBcbiAgICAgIC8vIExvYWQgYWNjZXNzaWJsZSBvcmdhbml6YXRpb25zIGZvciBhbGwgdXNlcnNcbiAgICAgIHJlZnJlc2hBY2Nlc3NpYmxlT3JnYW5pc2F0aW9ucygpXG4gICAgICBcbiAgICAgIC8vIExvYWQgY3VycmVudCBvcmdhbmlzYXRpb24gZm9yIHJlZ3VsYXIgdXNlcnNcbiAgICAgIGlmICghaXNTdXBlckFkbWluKSB7XG4gICAgICAgIHJlZnJlc2hDdXJyZW50T3JnYW5pc2F0aW9uKClcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gTG9hZCBhbGwgb3JnYW5pc2F0aW9ucyBmb3Igc3VwZXIgYWRtaW5zXG4gICAgICBpZiAoaXNTdXBlckFkbWluKSB7XG4gICAgICAgIHJlZnJlc2hBbGxPcmdhbmlzYXRpb25zKClcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKGlzQXV0aGVudGljYXRlZCAmJiB1c2VyICYmICFhdXRoU2VydmljZS5nZXRUb2tlbigpKSB7XG4gICAgICBjb25zb2xlLndhcm4oJ09yZ2FuaXNhdGlvblByb3ZpZGVyOiBVc2VyIGF1dGhlbnRpY2F0ZWQgYnV0IG5vIHRva2VuIGF2YWlsYWJsZSwgc2tpcHBpbmcgb3JnYW5pemF0aW9uIGRhdGEgbG9hZCcpXG4gICAgfVxuICB9LCBbaXNBdXRoZW50aWNhdGVkLCB1c2VyPy5pZCwgaXNTdXBlckFkbWluXSkgLy8gVXNlIHN0YWJsZSB1c2VyLmlkIGluc3RlYWQgb2YgZnVsbCB1c2VyIG9iamVjdFxuXG4gIGNvbnN0IGxvYWRBdmFpbGFibGVJbmR1c3RyaWVzID0gYXN5bmMgKCkgPT4ge1xuICAgIHRyeSB7XG4gICAgICBzZXRJc0xvYWRpbmdJbmR1c3RyaWVzKHRydWUpXG4gICAgICBjb25zdCBpbmR1c3RyaWVzID0gYXdhaXQgYXBpU2VydmljZS5nZXRBdmFpbGFibGVJbmR1c3RyaWVzKClcbiAgICAgIHNldEF2YWlsYWJsZUluZHVzdHJpZXMoaW5kdXN0cmllcylcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIGxvYWQgaW5kdXN0cmllczonLCBlcnJvcilcbiAgICB9IGZpbmFsbHkge1xuICAgICAgc2V0SXNMb2FkaW5nSW5kdXN0cmllcyhmYWxzZSlcbiAgICB9XG4gIH1cblxuICBjb25zdCByZWZyZXNoQ3VycmVudE9yZ2FuaXNhdGlvbiA9IGFzeW5jICgpID0+IHtcbiAgICBpZiAoIWlzQXV0aGVudGljYXRlZCB8fCAhYXV0aFNlcnZpY2UuZ2V0VG9rZW4oKSkge1xuICAgICAgY29uc29sZS53YXJuKCdDYW5ub3QgbG9hZCBjdXJyZW50IG9yZ2FuaXNhdGlvbjogbm90IGF1dGhlbnRpY2F0ZWQgb3Igbm8gdG9rZW4nKVxuICAgICAgcmV0dXJuXG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIHNldElzTG9hZGluZ0N1cnJlbnQodHJ1ZSlcbiAgICAgIGNvbnN0IG9yZ2FuaXNhdGlvbiA9IGF3YWl0IGFwaVNlcnZpY2UuZ2V0Q3VycmVudE9yZ2FuaXNhdGlvbigpXG4gICAgICBzZXRDdXJyZW50T3JnYW5pc2F0aW9uKG9yZ2FuaXNhdGlvbilcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gbG9hZCBjdXJyZW50IG9yZ2FuaXNhdGlvbjonLCBlcnJvcilcbiAgICAgIFxuICAgICAgLy8gSWYgaXQncyBhbiBhdXRoZW50aWNhdGlvbiBlcnJvciwgZG9uJ3Qgc2hvdyBpdCBhcyBhIGNyaXRpY2FsIGVycm9yXG4gICAgICBpZiAoZXJyb3I/LnJlc3BvbnNlPy5zdGF0dXMgPT09IDQwMSB8fCBlcnJvcj8ucmVzcG9uc2U/LnN0YXR1cyA9PT0gNDAzKSB7XG4gICAgICAgIGNvbnNvbGUud2FybignQXV0aGVudGljYXRpb24gaXNzdWUgbG9hZGluZyBjdXJyZW50IG9yZ2FuaXNhdGlvbiwgdXNlciBtYXkgbmVlZCB0byByZS1sb2dpbicpXG4gICAgICB9XG4gICAgICBcbiAgICAgIHNldEN1cnJlbnRPcmdhbmlzYXRpb24obnVsbClcbiAgICB9IGZpbmFsbHkge1xuICAgICAgc2V0SXNMb2FkaW5nQ3VycmVudChmYWxzZSlcbiAgICB9XG4gIH1cblxuICBjb25zdCByZWZyZXNoQWxsT3JnYW5pc2F0aW9ucyA9IGFzeW5jICgpID0+IHtcbiAgICBpZiAoIWlzU3VwZXJBZG1pbiB8fCAhaXNBdXRoZW50aWNhdGVkIHx8ICFhdXRoU2VydmljZS5nZXRUb2tlbigpKSB7XG4gICAgICBjb25zb2xlLndhcm4oJ0Nhbm5vdCBsb2FkIGFsbCBvcmdhbmlzYXRpb25zOiBub3Qgc3VwZXIgYWRtaW4sIG5vdCBhdXRoZW50aWNhdGVkLCBvciBubyB0b2tlbicpXG4gICAgICByZXR1cm5cbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgc2V0SXNMb2FkaW5nQWxsKHRydWUpXG4gICAgICBjb25zdCBvcmdhbmlzYXRpb25zID0gYXdhaXQgYXBpU2VydmljZS5nZXRBbGxPcmdhbmlzYXRpb25zKClcbiAgICAgIHNldEFsbE9yZ2FuaXNhdGlvbnMob3JnYW5pc2F0aW9ucylcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gbG9hZCBhbGwgb3JnYW5pc2F0aW9uczonLCBlcnJvcilcbiAgICAgIFxuICAgICAgLy8gSWYgaXQncyBhbiBhdXRoZW50aWNhdGlvbiBlcnJvciwgZG9uJ3Qgc2hvdyBpdCBhcyBhIGNyaXRpY2FsIGVycm9yXG4gICAgICBpZiAoZXJyb3I/LnJlc3BvbnNlPy5zdGF0dXMgPT09IDQwMSB8fCBlcnJvcj8ucmVzcG9uc2U/LnN0YXR1cyA9PT0gNDAzKSB7XG4gICAgICAgIGNvbnNvbGUud2FybignQXV0aGVudGljYXRpb24gaXNzdWUgbG9hZGluZyBhbGwgb3JnYW5pc2F0aW9ucywgdXNlciBtYXkgbmVlZCB0byByZS1sb2dpbicpXG4gICAgICB9XG4gICAgICBcbiAgICAgIHNldEFsbE9yZ2FuaXNhdGlvbnMoW10pXG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIHNldElzTG9hZGluZ0FsbChmYWxzZSlcbiAgICB9XG4gIH1cblxuICBjb25zdCBjcmVhdGVPcmdhbmlzYXRpb24gPSBhc3luYyAoZGF0YTogYW55KTogUHJvbWlzZTxPcmdhbmlzYXRpb24+ID0+IHtcbiAgICBpZiAoIWlzU3VwZXJBZG1pbikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdPbmx5IFN1cGVyIEFkbWlucyBjYW4gY3JlYXRlIG9yZ2FuaXNhdGlvbnMnKVxuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICBjb25zdCBuZXdPcmdhbmlzYXRpb24gPSBhd2FpdCBhcGlTZXJ2aWNlLmNyZWF0ZU9yZ2FuaXNhdGlvbihkYXRhKVxuICAgICAgXG4gICAgICAvLyBSZWZyZXNoIHRoZSBsaXN0IGFmdGVyIGNyZWF0aW9uXG4gICAgICBhd2FpdCByZWZyZXNoQWxsT3JnYW5pc2F0aW9ucygpXG4gICAgICBhd2FpdCByZWZyZXNoQWNjZXNzaWJsZU9yZ2FuaXNhdGlvbnMoKVxuICAgICAgXG4gICAgICByZXR1cm4gbmV3T3JnYW5pc2F0aW9uXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBjcmVhdGUgb3JnYW5pc2F0aW9uOicsIGVycm9yKVxuICAgICAgdGhyb3cgZXJyb3JcbiAgICB9XG4gIH1cblxuICBjb25zdCByZWZyZXNoQWNjZXNzaWJsZU9yZ2FuaXNhdGlvbnMgPSBhc3luYyAoKSA9PiB7XG4gICAgaWYgKCFpc0F1dGhlbnRpY2F0ZWQgfHwgIWF1dGhTZXJ2aWNlLmdldFRva2VuKCkpIHtcbiAgICAgIGNvbnNvbGUud2FybignQ2Fubm90IGxvYWQgYWNjZXNzaWJsZSBvcmdhbmlzYXRpb25zOiBub3QgYXV0aGVudGljYXRlZCBvciBubyB0b2tlbicpXG4gICAgICByZXR1cm5cbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgc2V0SXNMb2FkaW5nQWNjZXNzaWJsZSh0cnVlKVxuICAgICAgXG4gICAgICAvLyBGb3IgU3VwZXIgQWRtaW4sIGFjY2Vzc2libGUgb3JncyBhcmUgYWxsIG9yZ3NcbiAgICAgIGlmIChpc1N1cGVyQWRtaW4pIHtcbiAgICAgICAgY29uc3Qgb3JnYW5pc2F0aW9ucyA9IGF3YWl0IGFwaVNlcnZpY2UuZ2V0QWxsT3JnYW5pc2F0aW9ucygpXG4gICAgICAgIHNldEFjY2Vzc2libGVPcmdhbmlzYXRpb25zKG9yZ2FuaXNhdGlvbnMpXG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBGb3IgcmVndWxhciB1c2VycywgZ2V0IG9yZ2FuaXphdGlvbnMgdGhleSBoYXZlIGFjY2VzcyB0b1xuICAgICAgICBjb25zdCBvcmdhbmlzYXRpb25zID0gYXdhaXQgYXBpU2VydmljZS5nZXRVc2VyQWNjZXNzaWJsZU9yZ2FuaXNhdGlvbnMoKVxuICAgICAgICBzZXRBY2Nlc3NpYmxlT3JnYW5pc2F0aW9ucyhvcmdhbmlzYXRpb25zKVxuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBsb2FkIGFjY2Vzc2libGUgb3JnYW5pc2F0aW9uczonLCBlcnJvcilcbiAgICAgIFxuICAgICAgLy8gSWYgaXQncyBhbiBhdXRoZW50aWNhdGlvbiBlcnJvciwgZG9uJ3Qgc2hvdyBpdCBhcyBhIGNyaXRpY2FsIGVycm9yXG4gICAgICBpZiAoZXJyb3I/LnJlc3BvbnNlPy5zdGF0dXMgPT09IDQwMSB8fCBlcnJvcj8ucmVzcG9uc2U/LnN0YXR1cyA9PT0gNDAzKSB7XG4gICAgICAgIGNvbnNvbGUud2FybignQXV0aGVudGljYXRpb24gaXNzdWUgbG9hZGluZyBvcmdhbmlzYXRpb25zLCB1c2VyIG1heSBuZWVkIHRvIHJlLWxvZ2luJylcbiAgICAgIH0gZWxzZSBpZiAoZXJyb3I/LnJlc3BvbnNlPy5zdGF0dXMgPT09IDQwMCkge1xuICAgICAgICBjb25zb2xlLmVycm9yKCdCYWNrZW5kIEFQSSBlcnJvcjogb3JnYW5pc2F0aW9ucy9hY2Nlc3NpYmxlIGVuZHBvaW50IGhhcyBpbXBsZW1lbnRhdGlvbiBpc3N1ZXMnKVxuICAgICAgICBjb25zb2xlLndhcm4oJ1RoaXMgaXMgbGlrZWx5IGEgYmFja2VuZCBidWcgLSBtaXNzaW5nIHNlcnZpY2UgbWV0aG9kIG9yIGluY29ycmVjdCByb2xlIGNvbXBhcmlzb24nKVxuICAgICAgICAvLyBGb3Igbm93LCBmYWxsYmFjayB0byBlbXB0eSBsaXN0IHRvIHByZXZlbnQgYXBwIGNyYXNoXG4gICAgICB9XG4gICAgICBcbiAgICAgIHNldEFjY2Vzc2libGVPcmdhbmlzYXRpb25zKFtdKVxuICAgIH0gZmluYWxseSB7XG4gICAgICBzZXRJc0xvYWRpbmdBY2Nlc3NpYmxlKGZhbHNlKVxuICAgIH1cbiAgfVxuXG4gIGNvbnN0IHN3aXRjaE9yZ2FuaXNhdGlvbiA9IGFzeW5jIChvcmdJZDogc3RyaW5nKSA9PiB7XG4gICAgaWYgKCFpc0F1dGhlbnRpY2F0ZWQpIHJldHVyblxuXG4gICAgdHJ5IHtcbiAgICAgIHNldElzU3dpdGNoaW5nKHRydWUpXG4gICAgICBcbiAgICAgIC8vIFZhbGlkYXRlIHVzZXIgaGFzIGFjY2VzcyB0byB0aGlzIG9yZ2FuaXphdGlvblxuICAgICAgY29uc3QgaGFzQWNjZXNzID0gYWNjZXNzaWJsZU9yZ2FuaXNhdGlvbnMuc29tZShvcmcgPT4gb3JnLmlkID09PSBvcmdJZClcbiAgICAgIGlmICghaGFzQWNjZXNzKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignWW91IGRvIG5vdCBoYXZlIGFjY2VzcyB0byB0aGlzIG9yZ2FuaXphdGlvbicpXG4gICAgICB9XG5cbiAgICAgIC8vIENsZWFyIGFueSBjYWNoZWQgZGF0YSBmcm9tIHByZXZpb3VzIG9yZ2FuaXphdGlvbiBjb250ZXh0XG4gICAgICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgLy8gQ2xlYXIgYW55IG9yZ2FuaXphdGlvbi1zcGVjaWZpYyBjYWNoZSBrZXlzXG4gICAgICAgIGNvbnN0IGtleXNUb1JlbW92ZSA9IFtdXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbG9jYWxTdG9yYWdlLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgY29uc3Qga2V5ID0gbG9jYWxTdG9yYWdlLmtleShpKVxuICAgICAgICAgIGlmIChrZXkgJiYgKGtleS5pbmNsdWRlcygnb3JnXycpIHx8IGtleS5pbmNsdWRlcygndGVuYW50XycpKSkge1xuICAgICAgICAgICAga2V5c1RvUmVtb3ZlLnB1c2goa2V5KVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBrZXlzVG9SZW1vdmUuZm9yRWFjaChrZXkgPT4gbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oa2V5KSlcbiAgICAgIH1cblxuICAgICAgLy8gU2V0IHRoZSBuZXcgb3JnYW5pemF0aW9uIGNvbnRleHRcbiAgICAgIGNvbnN0IHRhcmdldE9yZyA9IGFjY2Vzc2libGVPcmdhbmlzYXRpb25zLmZpbmQob3JnID0+IG9yZy5pZCA9PT0gb3JnSWQpXG4gICAgICBpZiAodGFyZ2V0T3JnKSB7XG4gICAgICAgIHNldEN1cnJlbnRPcmdhbmlzYXRpb24odGFyZ2V0T3JnKVxuICAgICAgICBcbiAgICAgICAgLy8gUGVyc2lzdCBzZWxlY3Rpb25cbiAgICAgICAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3NlbGVjdGVkT3JnYW5pc2F0aW9uSWQnLCBvcmdJZClcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFVwZGF0ZSBBUEkgc2VydmljZSBvcmdhbml6YXRpb24gY29udGV4dFxuICAgICAgICBhcGlTZXJ2aWNlLnNldE9yZ2FuaXphdGlvbkNvbnRleHQob3JnSWQpXG5cbiAgICAgICAgLy8gQXVkaXQgbG9nIHRoZSBvcmdhbml6YXRpb24gc3dpdGNoXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgYXdhaXQgYXBpU2VydmljZS5sb2dPcmdhbml6YXRpb25Td2l0Y2gob3JnSWQpXG4gICAgICAgIH0gY2F0Y2ggKGF1ZGl0RXJyb3IpIHtcbiAgICAgICAgICBjb25zb2xlLndhcm4oJ0ZhaWxlZCB0byBsb2cgb3JnYW5pemF0aW9uIHN3aXRjaDonLCBhdWRpdEVycm9yKVxuICAgICAgICAgIC8vIERvbid0IGZhaWwgdGhlIHN3aXRjaCBpZiBhdWRpdCBsb2dnaW5nIGZhaWxzXG4gICAgICAgIH1cblxuICAgICAgICAvLyBUcmlnZ2VyIGRhdGEgcmVmcmVzaCBmb3IgY3VycmVudCBwYWdlXG4gICAgICAgIHdpbmRvdy5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgnb3JnYW5pemF0aW9uQ2hhbmdlZCcsIHsgXG4gICAgICAgICAgZGV0YWlsOiB7IG9yZ2FuaXphdGlvbklkOiBvcmdJZCwgb3JnYW5pemF0aW9uOiB0YXJnZXRPcmcgfSBcbiAgICAgICAgfSkpXG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBzd2l0Y2ggb3JnYW5pc2F0aW9uOicsIGVycm9yKVxuICAgICAgdGhyb3cgZXJyb3JcbiAgICB9IGZpbmFsbHkge1xuICAgICAgc2V0SXNTd2l0Y2hpbmcoZmFsc2UpXG4gICAgfVxuICB9XG5cbiAgY29uc3QgY29udGV4dFZhbHVlOiBPcmdhbmlzYXRpb25Db250ZXh0VHlwZSA9IHtcbiAgICBjdXJyZW50T3JnYW5pc2F0aW9uLFxuICAgIGFsbE9yZ2FuaXNhdGlvbnMsXG4gICAgYXZhaWxhYmxlSW5kdXN0cmllcyxcbiAgICBhY2Nlc3NpYmxlT3JnYW5pc2F0aW9ucyxcbiAgICBpc0xvYWRpbmdDdXJyZW50LFxuICAgIGlzTG9hZGluZ0FsbCxcbiAgICBpc0xvYWRpbmdJbmR1c3RyaWVzLFxuICAgIGlzTG9hZGluZ0FjY2Vzc2libGUsXG4gICAgaXNTd2l0Y2hpbmcsXG4gICAgcmVmcmVzaEN1cnJlbnRPcmdhbmlzYXRpb24sXG4gICAgcmVmcmVzaEFsbE9yZ2FuaXNhdGlvbnMsXG4gICAgY3JlYXRlT3JnYW5pc2F0aW9uLFxuICAgIHN3aXRjaE9yZ2FuaXNhdGlvbixcbiAgICByZWZyZXNoQWNjZXNzaWJsZU9yZ2FuaXNhdGlvbnMsXG4gICAgY2FuTWFuYWdlT3JnYW5pc2F0aW9ucyxcbiAgICBpc1N1cGVyQWRtaW5cbiAgfVxuXG4gIHJldHVybiAoXG4gICAgPE9yZ2FuaXNhdGlvbkNvbnRleHQuUHJvdmlkZXIgdmFsdWU9e2NvbnRleHRWYWx1ZX0+XG4gICAgICB7Y2hpbGRyZW59XG4gICAgPC9PcmdhbmlzYXRpb25Db250ZXh0LlByb3ZpZGVyPlxuICApXG59Il0sIm5hbWVzIjpbIk9yZ2FuaXNhdGlvblByb3ZpZGVyIiwidXNlT3JnYW5pc2F0aW9uQ29udGV4dCIsIk9yZ2FuaXNhdGlvbkNvbnRleHQiLCJjcmVhdGVDb250ZXh0IiwidW5kZWZpbmVkIiwiY29udGV4dCIsInVzZUNvbnRleHQiLCJFcnJvciIsImNoaWxkcmVuIiwidXNlciIsImlzQXV0aGVudGljYXRlZCIsImhhc1JvbGUiLCJ1c2VBdXRoQ29udGV4dCIsImN1cnJlbnRPcmdhbmlzYXRpb24iLCJzZXRDdXJyZW50T3JnYW5pc2F0aW9uIiwidXNlU3RhdGUiLCJhbGxPcmdhbmlzYXRpb25zIiwic2V0QWxsT3JnYW5pc2F0aW9ucyIsImF2YWlsYWJsZUluZHVzdHJpZXMiLCJzZXRBdmFpbGFibGVJbmR1c3RyaWVzIiwiYWNjZXNzaWJsZU9yZ2FuaXNhdGlvbnMiLCJzZXRBY2Nlc3NpYmxlT3JnYW5pc2F0aW9ucyIsImlzTG9hZGluZ0N1cnJlbnQiLCJzZXRJc0xvYWRpbmdDdXJyZW50IiwiaXNMb2FkaW5nQWxsIiwic2V0SXNMb2FkaW5nQWxsIiwiaXNMb2FkaW5nSW5kdXN0cmllcyIsInNldElzTG9hZGluZ0luZHVzdHJpZXMiLCJpc0xvYWRpbmdBY2Nlc3NpYmxlIiwic2V0SXNMb2FkaW5nQWNjZXNzaWJsZSIsImlzU3dpdGNoaW5nIiwic2V0SXNTd2l0Y2hpbmciLCJpc1N1cGVyQWRtaW4iLCJzZXRJc1N1cGVyQWRtaW4iLCJjYW5NYW5hZ2VPcmdhbmlzYXRpb25zIiwic2V0Q2FuTWFuYWdlT3JnYW5pc2F0aW9ucyIsImxhc3RMb2FkVGltZSIsInNldExhc3RMb2FkVGltZSIsInVzZUVmZmVjdCIsImFkbWluU3RhdHVzIiwiaWQiLCJyb2xlIiwid2luZG93Iiwic2F2ZWRPcmdJZCIsImxvY2FsU3RvcmFnZSIsImdldEl0ZW0iLCJub3ciLCJEYXRlIiwiY29uc29sZSIsIndhcm4iLCJhdXRoU2VydmljZSIsImdldFRva2VuIiwibG9nIiwibG9hZEF2YWlsYWJsZUluZHVzdHJpZXMiLCJyZWZyZXNoQWNjZXNzaWJsZU9yZ2FuaXNhdGlvbnMiLCJyZWZyZXNoQ3VycmVudE9yZ2FuaXNhdGlvbiIsInJlZnJlc2hBbGxPcmdhbmlzYXRpb25zIiwiaW5kdXN0cmllcyIsImFwaVNlcnZpY2UiLCJnZXRBdmFpbGFibGVJbmR1c3RyaWVzIiwiZXJyb3IiLCJvcmdhbmlzYXRpb24iLCJnZXRDdXJyZW50T3JnYW5pc2F0aW9uIiwicmVzcG9uc2UiLCJzdGF0dXMiLCJvcmdhbmlzYXRpb25zIiwiZ2V0QWxsT3JnYW5pc2F0aW9ucyIsImNyZWF0ZU9yZ2FuaXNhdGlvbiIsImRhdGEiLCJuZXdPcmdhbmlzYXRpb24iLCJnZXRVc2VyQWNjZXNzaWJsZU9yZ2FuaXNhdGlvbnMiLCJzd2l0Y2hPcmdhbmlzYXRpb24iLCJvcmdJZCIsImhhc0FjY2VzcyIsInNvbWUiLCJvcmciLCJrZXlzVG9SZW1vdmUiLCJpIiwibGVuZ3RoIiwia2V5IiwiaW5jbHVkZXMiLCJwdXNoIiwiZm9yRWFjaCIsInJlbW92ZUl0ZW0iLCJ0YXJnZXRPcmciLCJmaW5kIiwic2V0SXRlbSIsInNldE9yZ2FuaXphdGlvbkNvbnRleHQiLCJsb2dPcmdhbml6YXRpb25Td2l0Y2giLCJhdWRpdEVycm9yIiwiZGlzcGF0Y2hFdmVudCIsIkN1c3RvbUV2ZW50IiwiZGV0YWlsIiwib3JnYW5pemF0aW9uSWQiLCJvcmdhbml6YXRpb24iLCJjb250ZXh0VmFsdWUiLCJQcm92aWRlciIsInZhbHVlIl0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7Ozs7O0lBc0RhQSxvQkFBb0I7ZUFBcEJBOztJQVpBQyxzQkFBc0I7ZUFBdEJBOzs7OytEQXhDeUQ7cUJBRTNDO3NCQUNDO3lCQUNHOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFrQy9CLE1BQU1DLG9DQUFzQkMsSUFBQUEsb0JBQWEsRUFBc0NDO0FBRXhFLE1BQU1ILHlCQUF5QjtJQUNwQyxNQUFNSSxVQUFVQyxJQUFBQSxpQkFBVSxFQUFDSjtJQUMzQixJQUFJLENBQUNHLFNBQVM7UUFDWixNQUFNLElBQUlFLE1BQU07SUFDbEI7SUFDQSxPQUFPRjtBQUNUO0FBTU8sTUFBTUwsdUJBQTRELENBQUMsRUFBRVEsUUFBUSxFQUFFO0lBQ3BGLE1BQU0sRUFBRUMsSUFBSSxFQUFFQyxlQUFlLEVBQUVDLE9BQU8sRUFBRSxHQUFHQyxJQUFBQSx1QkFBYztJQUV6RCxNQUFNLENBQUNDLHFCQUFx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